---
title: "Combine line chart and area chart"
author: David Keyes
date: 2024-09-16
toc: false
format: gfm
execute: 
  warning: false
  message: false
knitr:
  opts_chunk:
    collapse: true
    comment: "#>"
    dev: "svglite"
    dev.args: { scaling: 1 }
    dpi: 300
    fig.height: 4.25
    fig.width: 8.5
editor_options: 
  chunk_output_type: console
---

**How to Create a Line Chart with Two Lines and a Filled Area Between Them for a Specific Part of the Chart Using the Gapminder Dataset**

In this guide, I’ll walk you through the steps of creating a line chart with two lines, where the area between the lines is filled only for a specific portion of the chart. We will use GDP per capita data from the Gapminder dataset and the `tidyverse` package in R.

The final plot will feature two lines showing GDP per capita over time for two countries, and we’ll fill the area between them for a defined period.

## Step 1: Load the Necessary Libraries

We'll begin by loading the `tidyverse` package, which includes `ggplot2` for plotting and `dplyr` for data manipulation.

```{r}
library(tidyverse)
library(gapminder)
```

We’ll use the Gapminder dataset, which comes with data on life expectancy, GDP per capita, and population for various countries over time.

## Step 2: Filter the Data

We’ll focus on two specific countries (e.g., "Australia" and "Japan") and plot their GDP per capita over time. To do this, we’ll filter the dataset accordingly.

```{r}
gdp_data <- gapminder %>%
   filter(country %in% c("Japan", "Australia")) %>%
   select(year, country, gdpPercap) %>%
   filter(year >= 1982)
```

Now that we’ve filtered the data to include only the Australia and Japan, let’s take a look at it:

```{r}
head(gdp_data)
```

## Step 3: Create a Basic Line Plot

To begin, we'll create a basic line chart that shows the GDP per capita for both the Australia and Japan over time.

```{r}
ggplot(gdp_data, aes(x = year, y = gdpPercap, color = country)) +
   geom_line(size = 1.2)
```

This creates a basic line chart, but now we need to add more features to meet the goal of filling the area between the two lines for a specific time period.

## Step 4: Highlight the Area Between the Two Lines for a Specific Time Period

### 4.1: Filter Data for the Highlighted Area

We'll focus on a specific time period to fill the area between the two lines. Let’s say we want to highlight the period between 1980 and 2000. We’ll first filter the data to include only that range of years.

```{r}
highlight_data <- gdp_data %>%
   filter(year > 2000 & year < 2010)
```

### 4.2: Create a Filled Area Between the Lines

To fill the area between the lines, we can use `geom_ribbon()`. This will help us shade the region between the two lines during the specified time period. We’ll need to reshape the data so that the GDP per capita for both countries appears in separate columns.

```{r}
highlight_data_wide <- highlight_data %>%
   pivot_wider(names_from = country, values_from = gdpPercap)

ggplot() +
   geom_ribbon(
      data = highlight_data_wide,
      aes(x = year, ymin = Japan, ymax = Australia),
      fill = "#ADD8E6", alpha = 0.5
   ) +
   geom_line(data = gdp_data, aes(x = year, y = gdpPercap, color = country), size = 1.2)
```

At this point, we have a plot with two lines and the area between them shaded for the years 1980-2000.

## Step 5: Customize the Plot

Now we’ll customize the plot to make it more visually appealing.

### 5.1: Add Labels and Titles

We’ll add a title, labels for the axes, and a caption for the data source.

```{r}
ggplot() +
   geom_ribbon(
      data = highlight_data_wide,
      aes(x = year, ymin = Japan, ymax = Australia),
      fill = "#ADD8E6", alpha = 0.5
   ) +
   geom_line(data = gdp_data, aes(x = year, y = gdpPercap, color = country), size = 1.2) +
   labs(
      title = "GDP Per Capita Comparison: Australia vs Japan",
      subtitle = "Area between the lines is highlighted for the years 1980-2000",
      x = "Year",
      y = "GDP Per Capita",
      caption = "Source: Gapminder"
   )
```

### 5.2: Improve the Color Scheme and Theme

We’ll refine the colors and use a minimal theme to make the chart cleaner.

```{r}
ggplot() +
   geom_ribbon(
      data = highlight_data_wide,
      aes(x = year, ymin = Japan, ymax = Australia),
      fill = "#ADD8E6", alpha = 0.5
   ) +
   geom_line(data = gdp_data, aes(x = year, y = gdpPercap, color = country), size = 1.2) +
   scale_color_manual(values = c("Japan" = "#FF6347", "Australia" = "#4682B4")) +
   labs(
      title = "GDP Per Capita Comparison: Australia vs Japan",
      subtitle = "Area between the lines is highlighted for the years 1980-2000",
      x = "Year",
      y = "GDP Per Capita",
      caption = "Source: Gapminder"
   ) +
   theme_minimal() +
   theme(
      plot.title = element_text(size = 18, face = "bold"),
      plot.subtitle = element_text(size = 14, margin = margin(b = 10)),
      axis.text = element_text(size = 12),
      axis.title = element_text(size = 14, face = "bold"),
      legend.title = element_blank()
   )
```

### 5.3: Adjust the Axis Formatting

Let’s adjust the y-axis labels to display GDP per capita in thousands for better readability.

```{r}
ggplot() +
   geom_ribbon(
      data = highlight_data_wide,
      aes(x = year, ymin = Japan, ymax = `Australia`),
      fill = "#ADD8E6", alpha = 0.5
   ) +
   geom_line(data = gdp_data, aes(x = year, y = gdpPercap, color = country), size = 1.2) +
   scale_color_manual(values = c("Japan" = "#FF6347", "Australia" = "#4682B4")) +
   scale_y_continuous(labels = scales::dollar_format(scale = 1 / 1000, suffix = "k")) +
   labs(
      title = "GDP Per Capita Comparison: Australia vs Japan",
      subtitle = "Area between the lines is highlighted for the years 1980-2000",
      x = "Year",
      y = "GDP Per Capita",
      caption = "Source: Gapminder"
   ) +
   theme_minimal() +
   theme(
      plot.title = element_text(size = 18, face = "bold"),
      plot.subtitle = element_text(size = 14, margin = margin(b = 10)),
      axis.text = element_text(size = 12),
      axis.title = element_text(size = 14, face = "bold"),
      legend.title = element_blank()
   )
```

## Final Result

You now have a polished line chart comparing GDP per capita between the Australia and Japan. The area between the two lines is filled for the years 1980-2000, making it easy to visually compare their economic performance during that period.

This technique is a great way to highlight differences between two variables over a specific range of time, helping the viewer focus on key periods of interest in the data.